<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AUTOTRACK - Smart Track Inspection</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');

        :root {
            --primary-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --secondary-gradient: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            --success-gradient: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            --warning-gradient: linear-gradient(135deg, #fa709a 0%, #fee140 100%);
            --danger-gradient: linear-gradient(135deg, #ff6b6b 0%, #ee5a52 100%);
            --dark-bg: #0a0e27;
            --card-bg: rgba(255, 255, 255, 0.08);
            --glass-border: rgba(255, 255, 255, 0.18);
            --text-primary: #ffffff;
            --text-secondary: #b4c6fb;
            --accent-blue: #4facfe;
            --accent-purple: #667eea;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: var(--dark-bg);
            background-image:
                radial-gradient(circle at 20% 80%, rgba(120, 119, 198, 0.3) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(255, 119, 198, 0.3) 0%, transparent 50%);
            color: var(--text-primary);
            overflow-x: hidden;
        }

        .background-animation {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            background: linear-gradient(-45deg, #0a0e27, #1a1f3a, #2d1b69, #0a0e27);
            background-size: 400% 400%;
            animation: gradientShift 15s ease infinite;
        }

        @keyframes gradientShift {
            0% {
                background-position: 0% 50%;
            }

            50% {
                background-position: 100% 50%;
            }

            100% {
                background-position: 0% 50%;
            }
        }

        .particles {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
        }

        .particle {
            position: absolute;
            background: var(--accent-blue);
            border-radius: 50%;
            animation: float 6s ease-in-out infinite;
        }

        @keyframes float {

            0%,
            100% {
                transform: translateY(0px);
            }

            50% {
                transform: translateY(-20px);
            }
        }

        /* Login Page Styles */
        .login-container {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 20px;
        }

        .login-card {
            background: var(--card-bg);
            backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            border-radius: 24px;
            padding: 48px;
            width: 100%;
            max-width: 450px;
            text-align: center;
            box-shadow:
                0 32px 64px rgba(0, 0, 0, 0.4),
                inset 0 1px 0 rgba(255, 255, 255, 0.1);
            animation: slideInUp 0.8s ease;
        }

        @keyframes slideInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .logo-container {
            margin-bottom: 32px;
        }

        .logo {
            font-size: 3rem;
            font-weight: 700;
            background: var(--primary-gradient);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 8px;
        }

        .tagline {
            color: var(--text-secondary);
            font-size: 1.1rem;
            font-weight: 300;
        }

        .form-group {
            margin-bottom: 24px;
            text-align: left;
        }

        .form-label {
            display: block;
            color: var(--text-primary);
            margin-bottom: 8px;
            font-weight: 500;
        }

        .form-input {
            width: 100%;
            background: rgba(255, 255, 255, 0.05);
            border: 2px solid rgba(255, 255, 255, 0.1);
            border-radius: 16px;
            padding: 16px 20px;
            color: var(--text-primary);
            font-size: 16px;
            font-family: 'Inter', sans-serif;
            transition: all 0.3s ease;
        }

        .form-input:focus {
            outline: none;
            border-color: var(--accent-blue);
            background: rgba(255, 255, 255, 0.08);
            transform: translateY(-2px);
            box-shadow: 0 8px 32px rgba(79, 172, 254, 0.2);
        }

        .form-input::placeholder {
            color: rgba(180, 198, 251, 0.5);
        }

        .login-btn {
            width: 100%;
            background: var(--primary-gradient);
            border: none;
            border-radius: 16px;
            padding: 18px;
            color: white;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            margin: 32px 0 16px 0;
            transition: all 0.3s ease;
            box-shadow: 0 8px 32px rgba(102, 126, 234, 0.4);
        }

        .login-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 12px 40px rgba(102, 126, 234, 0.6);
        }

        .login-btn:active {
            transform: translateY(0);
        }




        .credential-item {
            margin-bottom: 12px;
            padding: 8px 12px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            border-left: 4px solid var(--accent-blue);
        }

        .error-message {
            background: var(--danger-gradient);
            color: white;
            padding: 12px;
            border-radius: 12px;
            margin-top: 16px;
            display: none;
            animation: shake 0.5s ease;
        }

        @keyframes shake {

            0%,
            100% {
                transform: translateX(0);
            }

            25% {
                transform: translateX(-5px);
            }

            75% {
                transform: translateX(5px);
            }
        }

        /* Main App Styles */
        .main-app {
            display: none;
            animation: fadeIn 1s ease;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
            }

            to {
                opacity: 1;
            }
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 24px;
        }

        .header {
            background: var(--card-bg);
            backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            border-radius: 24px;
            padding: 24px 32px;
            margin-bottom: 32px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .app-title {
            font-size: 1.8rem;
            font-weight: 700;
            background: var(--primary-gradient);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .role-badge {
            background: var(--primary-gradient);
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 500;
            text-transform: capitalize;
        }

        .logout-btn {
            background: var(--danger-gradient);
            border: none;
            color: white;
            padding: 10px 20px;
            border-radius: 12px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s ease;
        }

        .logout-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 24px rgba(238, 90, 82, 0.4);
        }

        /* Dashboard Cards */
        .dashboard {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 32px;
            margin-bottom: 32px;
        }

        .feature-card {
            background: var(--card-bg);
            backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            border-radius: 24px;
            padding: 32px;
            text-align: center;
            transition: all 0.4s ease;
            position: relative;
            overflow: hidden;
        }

        .feature-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.1), transparent);
            transition: left 0.6s ease;
        }

        .feature-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        }

        .feature-card:hover::before {
            left: 100%;
        }

        .card-icon {
            font-size: 3rem;
            margin-bottom: 20px;
            background: var(--primary-gradient);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .card-title {
            font-size: 1.5rem;
            font-weight: 600;
            margin-bottom: 12px;
        }

        .card-description {
            color: var(--text-secondary);
            margin-bottom: 24px;
            line-height: 1.6;
        }

        .primary-btn {
            background: var(--primary-gradient);
            border: none;
            color: white;
            padding: 14px 28px;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            width: 100%;
            margin: 8px 0;
        }

        .primary-btn:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 12px 40px rgba(102, 126, 234, 0.4);
        }

        .primary-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            background: #333;
        }

        .secondary-btn {
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid rgba(255, 255, 255, 0.2);
            color: var(--text-primary);
            padding: 12px 24px;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 500;
        }

        .secondary-btn:hover {
            background: rgba(255, 255, 255, 0.15);
            border-color: var(--accent-blue);
            transform: translateY(-2px);
        }

        /* Modal Styles */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(10px);
            z-index: 1000;
            display: none;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .modal-content {
            background: var(--card-bg);
            backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            border-radius: 24px;
            padding: 32px;
            width: 100%;
            max-width: 600px;
            max-height: 90vh;
            overflow-y: auto;
            animation: modalSlideIn 0.4s ease;
        }

        @keyframes modalSlideIn {
            from {
                opacity: 0;
                transform: scale(0.9) translateY(20px);
            }

            to {
                opacity: 1;
                transform: scale(1) translateY(0);
            }
        }

        /* Camera Styles */
        .camera-container {
            text-align: center;
        }

        #video {
            width: 100%;
            max-width: 500px;
            height: 375px;
            border-radius: 16px;
            background: #000;
            border: 2px solid var(--glass-border);
            margin: 20px 0;
        }

        .scanner-overlay {
            position: relative;
            display: inline-block;
        }

        .scan-line {
            position: absolute;
            left: 10%;
            right: 10%;
            height: 3px;
            background: var(--success-gradient);
            border-radius: 2px;
            animation: scanLine 2s linear infinite;
            box-shadow: 0 0 20px rgba(79, 172, 254, 0.8);
        }

        @keyframes scanLine {
            0% {
                top: 20px;
                opacity: 1;
            }

            100% {
                top: calc(100% - 40px);
                opacity: 1;
            }
        }

        .scan-result {
            margin: 20px 0;
            padding: 16px;
            border-radius: 12px;
            font-weight: 500;
            display: none;
        }

        .scan-success {
            background: rgba(79, 172, 254, 0.2);
            border: 1px solid var(--accent-blue);
            color: var(--accent-blue);
        }

        .scan-error {
            background: rgba(255, 107, 107, 0.2);
            border: 1px solid #ff6b6b;
            color: #ff6b6b;
        }

        .scan-info {
            background: rgba(180, 198, 251, 0.2);
            border: 1px solid var(--text-secondary);
            color: var(--text-secondary);
        }

        /* Search and Info Panels */
        .panel {
            background: var(--card-bg);
            backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            border-radius: 24px;
            padding: 32px;
            margin: 24px 0;
            display: none;
            animation: slideInFromTop 0.5s ease;
        }

        @keyframes slideInFromTop {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .search-input {
            width: 100%;
            background: rgba(255, 255, 255, 0.05);
            border: 2px solid rgba(255, 255, 255, 0.1);
            border-radius: 16px;
            padding: 16px 20px;
            color: var(--text-primary);
            font-size: 16px;
            margin-bottom: 16px;
            transition: all 0.3s ease;
        }

        .search-input:focus {
            outline: none;
            border-color: var(--accent-blue);
            box-shadow: 0 0 20px rgba(79, 172, 254, 0.3);
        }

        /* Track Info Grid */
        .track-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
            flex-wrap: wrap;
            gap: 16px;
        }

        .track-id {
            font-size: 1.5rem;
            font-weight: 700;
            background: var(--primary-gradient);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .status-badge {
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .status-good {
            background: var(--success-gradient);
        }

        .status-warning {
            background: var(--warning-gradient);
        }

        .status-critical {
            background: var(--danger-gradient);
        }

        .info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin: 24px 0;
        }

        .info-item {
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 16px;
            padding: 20px;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .info-item.editable {
            cursor: pointer;
        }

        .info-item.editable:hover {
            border-color: var(--accent-blue);
            background: rgba(79, 172, 254, 0.05);
            transform: translateY(-2px);
        }

        .info-label {
            color: var(--text-secondary);
            font-size: 14px;
            font-weight: 500;
            margin-bottom: 8px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .info-value {
            color: var(--text-primary);
            font-size: 16px;
            font-weight: 600;
        }

        /* History Section */
        .history-section {
            margin-top: 40px;
        }

        .section-title {
            font-size: 1.3rem;
            font-weight: 600;
            margin-bottom: 24px;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .history-item {
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid rgba(255, 255, 255, 0.08);
            border-radius: 16px;
            padding: 24px;
            margin-bottom: 16px;
            transition: all 0.3s ease;
        }

        .history-item:hover {
            background: rgba(255, 255, 255, 0.05);
            transform: translateX(4px);
        }

        .history-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
            flex-wrap: wrap;
            gap: 8px;
        }

        .history-type {
            font-weight: 600;
            font-size: 16px;
        }

        .history-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 12px;
            margin-bottom: 16px;
        }

        .history-detail {
            font-size: 14px;
            color: var(--text-secondary);
        }

        .history-content {
            background: rgba(0, 0, 0, 0.2);
            border-radius: 12px;
            padding: 16px;
        }

        .content-item {
            margin-bottom: 12px;
        }

        .content-label {
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 4px;
        }

        /* Form Styles */
        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 24px;
            margin-bottom: 24px;
        }

        .form-textarea,
        .form-select {
            width: 100%;
            background: rgba(255, 255, 255, 0.05);
            border: 2px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 16px;
            color: var(--text-primary);
            font-size: 16px;
            font-family: 'Inter', sans-serif;
            transition: all 0.3s ease;
        }

        .form-textarea {
            min-height: 100px;
            resize: vertical;
        }

        .form-textarea:focus,
        .form-select:focus {
            outline: none;
            border-color: var(--accent-blue);
            box-shadow: 0 0 20px rgba(79, 172, 254, 0.2);
        }

        .form-actions {
            display: flex;
            gap: 16px;
            justify-content: center;
            margin-top: 32px;
        }

        .success-btn {
            background: var(--success-gradient);
            border: none;
            color: white;
            padding: 14px 28px;
            border-radius: 12px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .success-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 24px rgba(79, 172, 254, 0.4);
        }

        .danger-btn {
            background: var(--danger-gradient);
            border: none;
            color: white;
            padding: 14px 28px;
            border-radius: 12px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .danger-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 24px rgba(238, 90, 82, 0.4);
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .container {
                padding: 16px;
            }

            .dashboard {
                grid-template-columns: 1fr;
            }

            .header {
                flex-direction: column;
                gap: 16px;
                text-align: center;
            }

            .info-grid {
                grid-template-columns: 1fr;
            }

            .form-grid {
                grid-template-columns: 1fr;
            }

            .form-actions {
                flex-direction: column;
            }
        }

        /* Loading Animation */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: var(--accent-blue);
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }

        /* Utility Classes */
        .text-center {
            text-align: center;
        }

        .mb-16 {
            margin-bottom: 16px;
        }

        .mb-24 {
            margin-bottom: 24px;
        }

        .mt-16 {
            margin-top: 16px;
        }

        .hidden {
            display: none !important;
        }

        .flex {
            display: flex;
        }

        .items-center {
            align-items: center;
        }

        .justify-between {
            justify-content: space-between;
        }

        .gap-16 {
            gap: 16px;
        }
    </style>
</head>

<body>
    <div class="background-animation"></div>
    <div class="particles" id="particles"></div>

    <!-- Login Page -->
    <div id="loginPage" class="login-container">
        <div class="login-card">
            <div class="logo-container">
                <div class="logo">AUTOTRACK</div>
                <div class="tagline">Smart Railway Track Inspection System</div>
            </div>

            <form id="loginForm" onsubmit="return handleLogin(event)">
                <div class="form-group">
                    <label class="form-label">Username</label>
                    <input type="text" id="username" class="form-input" placeholder="Enter your username" required>
                </div>

                <div class="form-group">
                    <label class="form-label">Password</label>
                    <input type="password" id="password" class="form-input" placeholder="Enter your password" required>
                </div>

                <button type="submit" class="login-btn">
                    <span id="loginText">Sign In</span>
                    <div class="loading hidden" id="loginLoader"></div>
                </button>

                <div id="errorMessage" class="error-message">
                    Invalid credentials. Please check your username and password.
                </div>


        </div>
        </form>
    </div>
    </div>

    <!-- Main Application -->
    <div id="mainApp" class="main-app">
        <div class="container">
            <!-- Header -->
            <div class="header">
                <div class="header-left">
                    <div class="app-title">AUTOTRACK Dashboard</div>
                </div>
                <div class="user-info">
                    <div class="role-badge" id="userRole">Admin</div>
                    <button class="logout-btn" onclick="logout()">Logout</button>
                </div>
            </div>

            <!-- Dashboard Cards -->
            <div class="dashboard">
                <!-- QR Scanner Card -->
                <div class="feature-card" id="scannerCard">
                    <div class="card-icon">üì±</div>
                    <div class="card-title">QR Code Scanner</div>
                    <div class="card-description">
                        Advanced QR code scanner with real-time detection for quick track identification and inspection
                        workflows.
                    </div>
                    <button class="primary-btn" id="scanBtn" onclick="openCamera()">
                        Launch Scanner
                    </button>
                    <div style="margin-top: 16px; font-size: 14px; color: var(--text-secondary);">
                        üîê Inspector Access Required
                    </div>
                </div>

                <!-- 
                 Controls Card -->
                <div class="feature-card" id="adminCard">
                    <div class="card-icon">‚öôÔ∏è</div>
                    <div class="card-title">Admin Controls</div>
                    <div class="card-description">
                        Comprehensive track data management, search functionality, and administrative tools for system
                        oversight.
                    </div>
                    <button class="primary-btn" id="searchBtn" onclick="openSearch()">
                        Search Tracks
                    </button>
                    <button class="secondary-btn hidden" id="editBtn" onclick="enableEditMode()">
                        Enable Edit Mode
                    </button>
                    <div style="margin-top: 16px; font-size: 14px; color: var(--text-secondary);">
                        üîí Administrator Access Required
                    </div>
                </div>

                <!-- Analytics Card -->
                <div class="feature-card">
                    <div class="card-icon">üìä</div>
                    <div class="card-title">Track Analytics</div>
                    <div class="card-description">
                        Real-time insights and analytics dashboard showing track health status, inspection trends, and
                        maintenance schedules.
                    </div>
                    <button class="primary-btn" onclick="showAnalytics()">
                        View Analytics
                    </button>
                    <div style="margin-top: 16px; font-size: 14px; color: var(--text-secondary);">
                        üìà Coming Soon
                    </div>
                </div>
            </div>

            <!-- Search Panel -->
            <div id="searchPanel" class="panel">
                <h2 class="section-title">
                    üîç Track Search
                </h2>
                <div class="form-group">
                    <input type="text" id="searchInput" class="search-input"
                        placeholder="Enter Track ID (e.g., TN_MSB-KKB_L_0-100)"
                        onkeypress="handleSearchKeyPress(event)">
                </div>
                <div class="form-actions">
                    <button class="success-btn" onclick="searchTrack()">Search Track</button>
                    <button class="secondary-btn" onclick="closeSearch()">Close</button>
                </div>
            </div>

            <!-- Track Information Panel -->
            <div id="trackInfoPanel" class="panel">
                <div class="track-header">
                    <div>
                        <div class="track-id" id="trackTitle">Track Information</div>
                    </div>
                    <div class="flex items-center gap-16">
                        <div class="status-badge" id="trackStatus">Good</div>
                        <button id="saveChangesBtn" class="success-btn hidden" onclick="saveChanges()">
                            üíæ Save Changes
                        </button>
                    </div>
                </div>
                <div id="trackDetails"></div>
            </div>

            <!-- Inspection Form -->
            <div id="inspectionForm" class="panel">
                <h2 class="section-title">üìã Inspection Report</h2>
                <div class="form-grid">
                    <div class="form-group">
                        <label class="form-label">Track ID</label>
                        <input type="text" id="inspectionTrackId" class="form-input" readonly>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Inspector Name</label>
                        <input type="text" id="inspectorName" class="form-input" placeholder="Enter inspector name">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Inspection Type</label>
                        <select id="inspectionType" class="form-select">
                            <option value="">Select inspection type</option>
                            <option value="Routine Inspection">Routine Inspection</option>
                            <option value="Crack Detection">Crack Detection</option>
                            <option value="Rail Replacement">Rail Replacement</option>
                            <option value="Ballast Cleaning">Ballast Cleaning</option>
                            <option value="Sleeper Replacement">Sleeper Replacement</option>
                            <option value="Emergency Inspection">Emergency Inspection</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Track Health Status</label>
                        <select id="healthStatus" class="form-select">
                            <option value="">Select health status</option>
                            <option value="Good">Good</option>
                            <option value="Warning">Warning</option>
                            <option value="Critical">Critical</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Issues Found</label>
                        <textarea id="issuesFound" class="form-textarea"
                            placeholder="Describe any issues found during inspection..."></textarea>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Recommendations</label>
                        <textarea id="recommendations" class="form-textarea"
                            placeholder="Enter recommendations for maintenance or repairs..."></textarea>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Next Inspection Date</label>
                        <input type="date" id="nextInspectionDate" class="form-input">
                    </div>
                </div>
                <div class="form-actions">
                    <button class="success-btn" onclick="submitInspection()">Submit Report</button>
                    <button class="danger-btn" onclick="cancelInspection()">Cancel</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Camera Modal -->
    <div id="cameraModal" class="modal">
        <div class="modal-content camera-container">
            <h2 class="section-title">üì∑ QR Code Scanner</h2>
            <div class="scanner-overlay">
                <video id="video" autoplay muted playsinline></video>
                <div class="scan-line"></div>
            </div>
            <canvas id="canvas" style="display: none;"></canvas>
            <div id="scanResult" class="scan-result"></div>
            <div class="form-actions">
                <button class="secondary-btn" onclick="closeCamera()">Close Scanner</button>
                <button class="secondary-btn" onclick="processManualQR()">Manual Input</button>
                <button class="primary-btn" onclick="testQRCode()">Test Sample QR</button>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jsqr/1.4.0/jsQR.min.js"></script>
    <script>
        // Global State
        let currentUser = '';
        let currentUserRole = '';
        let currentTrackId = '';
        let camera = null;
        let scanInterval = null;
        let isEditMode = false;
        let editedData = {};
        let video = null;
        let canvas = null;
        let context = null;

        // Credentials
        const credentials = {
            'Admin': { password: 'Admin', role: 'Admin' },
            'Inspector': { password: 'Inspector', role: 'Inspector' }
        };

        // Enhanced Track Database
        const trackDatabase = {
            'TN_MSB-KKB_L_0-100': {
                state: 'Tamil Nadu',
                route: 'MSB-KKB',
                side: 'Left',
                chunk: '0-100',
                installationDate: '2019-03-15',
                lastInspection: '2024-09-10',
                nextInspection: '2024-12-10',
                vendor: 'Indian Railways Track Corp',
                trackHealth: 'Good',
                material: 'Steel Rails 52kg/m',
                length: '100m',
                coordinates: '13.0827¬∞N, 80.2707¬∞E',
                inspectionHistory: [
                    {
                        date: '2024-09-10',
                        type: 'Routine Inspection',
                        status: 'Completed',
                        inspector: 'Raj Kumar',
                        issues: 'All systems operational, no defects detected',
                        recommendations: 'Continue regular maintenance schedule'
                    },
                    {
                        date: '2024-06-15',
                        type: 'Crack Detection',
                        status: 'Completed',
                        inspector: 'Priya Singh',
                        issues: 'Minor surface wear on rail head detected',
                        recommendations: 'Monitor wear patterns, schedule grinding if progression continues'
                    }
                ]
            },
            'TN_MSB-KKB_R_100-200': {
                state: 'Tamil Nadu',
                route: 'MSB-KKB',
                side: 'Right',
                chunk: '100-200',
                installationDate: '2018-11-22',
                lastInspection: '2024-09-08',
                nextInspection: '2024-12-08',
                vendor: 'Rail Infrastructure Ltd',
                trackHealth: 'Warning',
                material: 'Steel Rails 60kg/m',
                length: '100m',
                coordinates: '13.0835¬∞N, 80.2715¬∞E',
                inspectionHistory: [
                    {
                        date: '2024-09-08',
                        type: 'Emergency Inspection',
                        status: 'Issues Found',
                        inspector: 'Suresh Kumar',
                        issues: 'Hairline cracks detected on rail joint at kilometer 150.5',
                        recommendations: 'Immediate rail joint replacement required within 2 weeks'
                    },
                    {
                        date: '2024-07-20',
                        type: 'Crack Detection',
                        status: 'Issues Found',
                        inspector: 'Meena Patel',
                        issues: 'Progressive surface fatigue cracks visible on main rail',
                        recommendations: 'Reduce maximum train speed to 80 km/h, plan replacement'
                    }
                ]
            },
            'KL_TCR-ERS_L_200-300': {
                state: 'Kerala',
                route: 'TCR-ERS',
                side: 'Left',
                chunk: '200-300',
                installationDate: '2020-07-10',
                lastInspection: '2024-09-15',
                nextInspection: '2024-12-15',
                vendor: 'Southern Railway Contractors',
                trackHealth: 'Good',
                material: 'Steel Rails 60kg/m',
                length: '100m',
                coordinates: '10.0261¬∞N, 76.3109¬∞E',
                inspectionHistory: [
                    {
                        date: '2024-09-15',
                        type: 'Routine Inspection',
                        status: 'Completed',
                        inspector: 'Thomas Joseph',
                        issues: 'Track in excellent condition, all parameters within specifications',
                        recommendations: 'Maintain current inspection and maintenance schedule'
                    }
                ]
            }
        };

        // Initialize Application
        document.addEventListener('DOMContentLoaded', function () {
            createParticles();
            document.getElementById('username').focus();

            // Initialize camera components
            video = document.getElementById('video');
            canvas = document.getElementById('canvas');
            if (canvas) {
                context = canvas.getContext('2d');
            }
        });

        // Particle Animation
        function createParticles() {
            const particles = document.getElementById('particles');
            const particleCount = 20;

            for (let i = 0; i < particleCount; i++) {
                const particle = document.createElement('div');
                particle.className = 'particle';
                particle.style.left = Math.random() * 100 + '%';
                particle.style.top = Math.random() * 100 + '%';
                particle.style.width = particle.style.height = Math.random() * 4 + 2 + 'px';
                particle.style.animationDelay = Math.random() * 6 + 's';
                particle.style.opacity = Math.random() * 0.5 + 0.1;
                particles.appendChild(particle);
            }
        }

        // Authentication
        async function handleLogin(event) {
            event.preventDefault();

            const username = document.getElementById('username').value.trim();
            const password = document.getElementById('password').value.trim();
            const errorMessage = document.getElementById('errorMessage');
            const loginText = document.getElementById('loginText');
            const loginLoader = document.getElementById('loginLoader');

            // Show loading state
            loginText.textContent = 'Signing In...';
            loginLoader.classList.remove('hidden');
            errorMessage.style.display = 'none';

            // Simulate authentication delay
            await new Promise(resolve => setTimeout(resolve, 1000));

            if (credentials[username] && credentials[username].password === password) {
                currentUser = username;
                currentUserRole = credentials[username].role;

                // Hide login, show main app
                document.getElementById('loginPage').style.display = 'none';
                document.getElementById('mainApp').style.display = 'block';
                document.getElementById('userRole').textContent =
                    currentUserRole.charAt(0).toUpperCase() + currentUserRole.slice(1);

                setupRoleBasedUI(currentUserRole);

                // Clear form
                document.getElementById('username').value = '';
                document.getElementById('password').value = '';
            } else {
                errorMessage.style.display = 'block';
                document.getElementById('password').value = '';
            }

            // Reset button state
            loginText.textContent = 'Sign In';
            loginLoader.classList.add('hidden');

            return false;
        }

        function setupRoleBasedUI(role) {
            const scanBtn = document.getElementById('scanBtn');
            const searchBtn = document.getElementById('searchBtn');
            const scannerCard = document.getElementById('scannerCard');
            const adminCard = document.getElementById('adminCard');

            if (role === 'inspector') {
                scanBtn.disabled = false;
                searchBtn.disabled = true;
                adminCard.style.opacity = '0.6';
                scannerCard.style.opacity = '1';
            } else if (role === 'admin') {
                searchBtn.disabled = false;
                scanBtn.disabled = true;
                scannerCard.style.opacity = '0.6';
                adminCard.style.opacity = '1';
            }
        }

        function logout() {
            currentUser = '';
            currentUserRole = '';
            currentTrackId = '';
            isEditMode = false;
            editedData = {};

            document.getElementById('loginPage').style.display = 'flex';
            document.getElementById('mainApp').style.display = 'none';
            hideAllPanels();

            if (camera) {
                closeCamera();
            }
        }

        function hideAllPanels() {
            document.getElementById('trackInfoPanel').style.display = 'none';
            document.getElementById('searchPanel').style.display = 'none';
            document.getElementById('inspectionForm').style.display = 'none';
        }

        // Camera Functions
        async function openCamera() {
            if (currentUserRole !== 'inspector') {
                showNotification('Only inspectors can access the QR scanner!', 'error');
                return;
            }

            document.getElementById('cameraModal').style.display = 'flex';
            showScanResult('Initializing camera...', 'info');

            try {
                const constraints = {
                    video: {
                        facingMode: 'environment',
                        width: { ideal: 1280, min: 640 },
                        height: { ideal: 720, min: 480 }
                    }
                };

                const stream = await navigator.mediaDevices.getUserMedia(constraints);
                video.srcObject = stream;
                camera = stream;

                video.onloadedmetadata = () => {
                    video.play();
                    showScanResult('Camera ready! Position QR code in view...', 'info');
                    startQRScanning();
                };

            } catch (error) {
                console.error('Camera access error:', error);
                let errorMsg = 'Camera access failed. ';

                if (error.name === 'NotAllowedError') {
                    errorMsg += 'Please allow camera permission.';
                } else if (error.name === 'NotFoundError') {
                    errorMsg += 'No camera found.';
                } else {
                    errorMsg += 'Please ensure HTTPS and camera availability.';
                }

                showScanResult(errorMsg, 'error');
                setTimeout(() => closeCamera(), 3000);
            }
        }

        function startQRScanning() {
            if (scanInterval) clearInterval(scanInterval);

            scanInterval = setInterval(() => {
                if (video && video.readyState === video.HAVE_ENOUGH_DATA) {
                    try {
                        canvas.width = video.videoWidth;
                        canvas.height = video.videoHeight;
                        context.drawImage(video, 0, 0, canvas.width, canvas.height);

                        const imageData = context.getImageData(0, 0, canvas.width, canvas.height);
                        const code = jsQR(imageData.data, imageData.width, imageData.height, {
                            inversionAttempts: "attemptBoth"
                        });

                        if (code && code.data) {
                            processQRCode(code.data);
                        }
                    } catch (error) {
                        console.error('QR scanning error:', error);
                    }
                }
            }, 100);
        }

        function processQRCode(qrData) {
            if (scanInterval) {
                clearInterval(scanInterval);
                scanInterval = null;
            }

            if (!validateQRFormat(qrData)) {
                showScanResult('Invalid QR code format! Expected: STATE_ROUTE_SIDE_CHUNK', 'error');
                setTimeout(() => {
                    if (video && video.srcObject) {
                        startQRScanning();
                    }
                }, 2000);
                return;
            }

            showScanResult(`Valid QR Code: ${qrData}`, 'success');

            setTimeout(() => {
                closeCamera();
                if (trackDatabase[qrData]) {
                    displayTrackInfo(qrData);
                    showInspectionForm(qrData);
                } else {
                    showNotification(`Track data not found for: ${qrData}`, 'error');
                }
            }, 1500);
        }

        function validateQRFormat(qrData) {
            const pattern = /^[A-Z]{2}_[A-Z0-9]+-[A-Z0-9]+_[LR]_\d+-\d+$/;
            return pattern.test(qrData);
        }

        function showScanResult(message, type) {
            const resultDiv = document.getElementById('scanResult');
            resultDiv.style.display = 'block';
            resultDiv.textContent = message;
            resultDiv.className = `scan-result scan-${type}`;
        }

        function testQRCode() {
            processQRCode('TN_MSB-KKB_L_0-100');
        }

        function processManualQR() {
            const availableCodes = Object.keys(trackDatabase).join('\n');
            const qrData = prompt(`Enter QR Code:\n\nAvailable codes:\n${availableCodes}`);

            if (qrData && qrData.trim()) {
                const cleanQrData = qrData.trim().toUpperCase();
                if (validateQRFormat(cleanQrData)) {
                    closeCamera();
                    if (trackDatabase[cleanQrData]) {
                        displayTrackInfo(cleanQrData);
                        showInspectionForm(cleanQrData);
                    } else {
                        showNotification(`Track not found: ${cleanQrData}`, 'error');
                    }
                } else {
                    showNotification('Invalid QR code format!', 'error');
                }
            }
        }

        function closeCamera() {
            if (scanInterval) {
                clearInterval(scanInterval);
                scanInterval = null;
            }

            if (camera) {
                camera.getTracks().forEach(track => track.stop());
                camera = null;
            }

            if (video) {
                video.srcObject = null;
            }

            document.getElementById('cameraModal').style.display = 'none';
            document.getElementById('scanResult').style.display = 'none';
        }

        // Search Functions
        function openSearch() {
            if (currentUserRole !== 'admin') {
                showNotification('Only administrators can search tracks!', 'error');
                return;
            }

            document.getElementById('searchPanel').style.display = 'block';
            document.getElementById('searchInput').focus();
        }

        function closeSearch() {
            document.getElementById('searchPanel').style.display = 'none';
            document.getElementById('searchInput').value = '';
        }

        function handleSearchKeyPress(event) {
            if (event.key === 'Enter') {
                searchTrack();
            }
        }

        function searchTrack() {
            const searchInput = document.getElementById('searchInput');
            const qrData = searchInput.value.trim().toUpperCase();

            if (!qrData) {
                showNotification('Please enter a Track ID', 'error');
                return;
            }

            if (!validateQRFormat(qrData)) {
                showNotification('Invalid format! Use: STATE_ROUTE_SIDE_CHUNK', 'error');
                return;
            }

            if (trackDatabase[qrData]) {
                displayTrackInfo(qrData);
                document.getElementById('editBtn').classList.remove('hidden');
                closeSearch();
            } else {
                showNotification(`Track not found: ${qrData}`, 'error');
            }
        }

        // Track Display Functions
        function displayTrackInfo(qrData) {
            const trackData = trackDatabase[qrData];
            currentTrackId = qrData;

            if (!trackData) {
                showNotification('Track information not found', 'error');
                return;
            }

            const trackInfoPanel = document.getElementById('trackInfoPanel');
            const trackDetails = document.getElementById('trackDetails');
            const trackStatus = document.getElementById('trackStatus');

            // Update header
            document.getElementById('trackTitle').textContent = qrData;
            trackStatus.textContent = trackData.trackHealth;
            trackStatus.className = `status-badge status-${trackData.trackHealth.toLowerCase()}`;

            // Build info grid
            trackDetails.innerHTML = `
                <div class="info-grid">
                    ${createInfoItem('state', 'State', trackData.state)}
                    ${createInfoItem('route', 'Route', trackData.route)}
                    ${createInfoItem('side', 'Side', trackData.side)}
                    ${createInfoItem('chunk', 'Chunk', trackData.chunk)}
                    ${createInfoItem('installationDate', 'Installation Date', trackData.installationDate)}
                    ${createInfoItem('lastInspection', 'Last Inspection', trackData.lastInspection)}
                    ${createInfoItem('nextInspection', 'Next Inspection', trackData.nextInspection)}
                    ${createInfoItem('vendor', 'Vendor', trackData.vendor)}
                    ${createInfoItem('material', 'Material', trackData.material)}
                    ${createInfoItem('length', 'Length', trackData.length)}
                    ${createInfoItem('coordinates', 'Coordinates', trackData.coordinates)}
                </div>
                
                <div class="history-section">
                    <h3 class="section-title">üìã Inspection History</h3>
                    ${trackData.inspectionHistory.map(record => createHistoryItem(record)).join('')}
                </div>
            `;

            trackInfoPanel.style.display = 'block';
            trackInfoPanel.scrollIntoView({ behavior: 'smooth' });
        }

        function createInfoItem(field, label, value) {
            const isEditable = currentUserRole === 'admin' && ['state', 'route', 'installationDate', 'nextInspection', 'vendor', 'material', 'length', 'coordinates'].includes(field);
            return `
                <div class="info-item ${isEditable ? 'editable' : ''}" 
                     ${isEditable ? `data-field="${field}" onclick="editField('${field}')"` : ''}>
                    <div class="info-label">${label}</div>
                    <div class="info-value" id="value-${field}">${value}</div>
                </div>
            `;
        }

        function createHistoryItem(record) {
            const statusClass = record.status === 'Completed' ? 'status-good' :
                record.status === 'Issues Found' ? 'status-warning' : 'status-critical';

            return `
                <div class="history-item">
                    <div class="history-header">
                        <div class="history-type">${record.type}</div>
                        <div class="status-badge ${statusClass}">${record.status}</div>
                    </div>
                    <div class="history-details">
                        <div class="history-detail">Date: ${record.date}</div>
                        <div class="history-detail">Inspector: ${record.inspector}</div>
                    </div>
                    <div class="history-content">
                        <div class="content-item">
                            <div class="content-label">Issues Found:</div>
                            <div>${record.issues}</div>
                        </div>
                        <div class="content-item">
                            <div class="content-label">Recommendations:</div>
                            <div>${record.recommendations}</div>
                        </div>
                    </div>
                </div>
            `;
        }

        // Edit Functions
        function enableEditMode() {
            if (currentUserRole !== 'admin') {
                showNotification('Only administrators can edit data!', 'error');
                return;
            }

            isEditMode = true;
            document.getElementById('editBtn').classList.add('hidden');
            document.getElementById('saveChangesBtn').classList.remove('hidden');

            const editableItems = document.querySelectorAll('.info-item.editable');
            editableItems.forEach(item => {
                item.style.border = '2px dashed var(--accent-blue)';
                item.style.background = 'rgba(79, 172, 254, 0.05)';
            });

            showNotification('Edit mode enabled! Click highlighted fields to edit.', 'info');
        }

        function editField(fieldName) {
            if (!isEditMode || currentUserRole !== 'admin') return;

            const valueElement = document.getElementById(`value-${fieldName}`);
            const currentValue = valueElement.textContent;

            const input = document.createElement('input');
            input.type = fieldName.includes('Date') ? 'date' : 'text';
            input.className = 'form-input';
            input.style.margin = '0';
            input.style.padding = '8px';
            input.value = currentValue;

            input.onblur = () => finishEditing(fieldName, input.value, valueElement);
            input.onkeypress = (e) => {
                if (e.key === 'Enter') {
                    finishEditing(fieldName, input.value, valueElement);
                }
            };

            valueElement.innerHTML = '';
            valueElement.appendChild(input);
            input.focus();
        }

        function finishEditing(fieldName, newValue, valueElement) {
            if (newValue.trim() === '') {
                showNotification('Value cannot be empty!', 'error');
                displayTrackInfo(currentTrackId);
                return;
            }

            editedData[fieldName] = newValue.trim();
            valueElement.textContent = newValue.trim();
            valueElement.style.color = 'var(--accent-blue)';
        }

        function saveChanges() {
            if (!isEditMode || !currentTrackId) return;

            if (Object.keys(editedData).length === 0) {
                showNotification('No changes to save!', 'error');
                return;
            }

            Object.keys(editedData).forEach(field => {
                trackDatabase[currentTrackId][field] = editedData[field];
            });

            isEditMode = false;
            editedData = {};
            document.getElementById('editBtn').classList.remove('hidden');
            document.getElementById('saveChangesBtn').classList.add('hidden');

            showNotification(`Changes saved for ${currentTrackId}!`, 'success');
            displayTrackInfo(currentTrackId);
        }

        // Inspection Form Functions
        function showInspectionForm(qrData) {
            if (currentUserRole !== 'inspector') return;

            document.getElementById('inspectionTrackId').value = qrData;
            document.getElementById('inspectionForm').style.display = 'block';
            document.getElementById('inspectionForm').scrollIntoView({ behavior: 'smooth' });

            const futureDate = new Date();
            futureDate.setDate(futureDate.getDate() + 90);
            document.getElementById('nextInspectionDate').value = futureDate.toISOString().split('T')[0];
        }

        function submitInspection() {
            const trackId = document.getElementById('inspectionTrackId').value;
            const inspectorName = document.getElementById('inspectorName').value.trim();
            const inspectionType = document.getElementById('inspectionType').value;
            const healthStatus = document.getElementById('healthStatus').value;
            const issuesFound = document.getElementById('issuesFound').value.trim();
            const recommendations = document.getElementById('recommendations').value.trim();
            const nextInspectionDate = document.getElementById('nextInspectionDate').value;

            if (!inspectorName || !inspectionType || !healthStatus || !issuesFound || !recommendations || !nextInspectionDate) {
                showNotification('Please fill in all required fields!', 'error');
                return;
            }

            const newInspection = {
                date: new Date().toISOString().split('T')[0],
                type: inspectionType,
                status: healthStatus === 'Critical' ? 'Issues Found' : 'Completed',
                inspector: inspectorName,
                issues: issuesFound,
                recommendations: recommendations
            };

            if (trackDatabase[trackId]) {
                trackDatabase[trackId].inspectionHistory.unshift(newInspection);
                trackDatabase[trackId].lastInspection = newInspection.date;
                trackDatabase[trackId].nextInspection = nextInspectionDate;
                trackDatabase[trackId].trackHealth = healthStatus;
            }

            showNotification('Inspection report submitted successfully!', 'success');
            cancelInspection();
            displayTrackInfo(trackId);
        }

        function cancelInspection() {
            document.getElementById('inspectionForm').style.display = 'none';

            document.getElementById('inspectorName').value = '';
            document.getElementById('inspectionType').value = '';
            document.getElementById('healthStatus').value = '';
            document.getElementById('issuesFound').value = '';
            document.getElementById('recommendations').value = '';
            document.getElementById('nextInspectionDate').value = '';
        }

        // Analytics Function (placeholder)
        function showAnalytics() {
            showNotification('Analytics dashboard coming soon!', 'info');
        }

        // Utility Functions
        function showNotification(message, type) {
            const notification = document.createElement('div');
            notification.className = `scan-result scan-${type}`;
            notification.textContent = message;
            notification.style.position = 'fixed';
            notification.style.top = '20px';
            notification.style.right = '20px';
            notification.style.zIndex = '10000';
            notification.style.display = 'block';
            notification.style.animation = 'slideInFromTop 0.5s ease';

            document.body.appendChild(notification);

            setTimeout(() => {
                notification.remove();
            }, 3000);
        }

        // Event Handlers
        document.addEventListener('keydown', function (event) {
            if (document.getElementById('mainApp').style.display === 'none') return;

            if (event.ctrlKey && event.key === 's' && currentUserRole === 'inspector') {
                event.preventDefault();
                openCamera();
            }

            if (event.ctrlKey && event.key === 'f' && currentUserRole === 'admin') {
                event.preventDefault();
                openSearch();
            }

            if (event.key === 'Escape') {
                if (document.getElementById('cameraModal').style.display === 'flex') {
                    closeCamera();
                } else if (document.getElementById('searchPanel').style.display === 'block') {
                    closeSearch();
                }
            }
        });

        window.addEventListener('beforeunload', function () {
            if (camera) {
                closeCamera();
            }
        });

        // Enhanced UI Interactions
        document.addEventListener('click', function (event) {
            // Close modals when clicking outside
            if (event.target.classList.contains('modal')) {
                if (event.target.id === 'cameraModal') {
                    closeCamera();
                }
            }
        });

        // Smooth scrolling for navigation
        function smoothScrollTo(elementId) {
            document.getElementById(elementId).scrollIntoView({
                behavior: 'smooth',
                block: 'start'
            });
        }

        // Auto-save feature for forms
        let autoSaveTimer;
        function setupAutoSave() {
            const formInputs = document.querySelectorAll('#inspectionForm input, #inspectionForm textarea, #inspectionForm select');
            formInputs.forEach(input => {
                input.addEventListener('input', () => {
                    clearTimeout(autoSaveTimer);
                    autoSaveTimer = setTimeout(() => {
                        saveFormData();
                    }, 2000);
                });
            });
        }

        function saveFormData() {
            const formData = {
                inspectorName: document.getElementById('inspectorName').value,
                inspectionType: document.getElementById('inspectionType').value,
                healthStatus: document.getElementById('healthStatus').value,
                issuesFound: document.getElementById('issuesFound').value,
                recommendations: document.getElementById('recommendations').value,
                nextInspectionDate: document.getElementById('nextInspectionDate').value
            };

            // Save to session storage (temporary, for demo purposes)
            sessionStorage.setItem('inspectionFormData', JSON.stringify(formData));
        }

        function loadFormData() {
            const savedData = sessionStorage.getItem('inspectionFormData');
            if (savedData) {
                const formData = JSON.parse(savedData);
                document.getElementById('inspectorName').value = formData.inspectorName || '';
                document.getElementById('inspectionType').value = formData.inspectionType || '';
                document.getElementById('healthStatus').value = formData.healthStatus || '';
                document.getElementById('issuesFound').value = formData.issuesFound || '';
                document.getElementById('recommendations').value = formData.recommendations || '';
                document.getElementById('nextInspectionDate').value = formData.nextInspectionDate || '';
            }
        }

        // Performance optimization for animations
        function optimizeAnimations() {
            const cards = document.querySelectorAll('.feature-card');
            cards.forEach(card => {
                card.addEventListener('mouseenter', function () {
                    this.style.willChange = 'transform';
                });
                card.addEventListener('mouseleave', function () {
                    this.style.willChange = 'auto';
                });
            });
        }

        // Data validation helpers
        function validateInspectionData(data) {
            const errors = [];

            if (!data.inspectorName || data.inspectorName.length < 2) {
                errors.push('Inspector name must be at least 2 characters');
            }

            if (!data.inspectionType) {
                errors.push('Please select an inspection type');
            }

            if (!data.healthStatus) {
                errors.push('Please select track health status');
            }

            if (!data.issuesFound || data.issuesFound.length < 10) {
                errors.push('Issues description must be at least 10 characters');
            }

            if (!data.recommendations || data.recommendations.length < 10) {
                errors.push('Recommendations must be at least 10 characters');
            }

            if (!data.nextInspectionDate) {
                errors.push('Please select next inspection date');
            } else {
                const nextDate = new Date(data.nextInspectionDate);
                const today = new Date();
                if (nextDate <= today) {
                    errors.push('Next inspection date must be in the future');
                }
            }

            return errors;
        }

        // Enhanced submitInspection with validation
        function submitInspection() {
            const data = {
                trackId: document.getElementById('inspectionTrackId').value,
                inspectorName: document.getElementById('inspectorName').value.trim(),
                inspectionType: document.getElementById('inspectionType').value,
                healthStatus: document.getElementById('healthStatus').value,
                issuesFound: document.getElementById('issuesFound').value.trim(),
                recommendations: document.getElementById('recommendations').value.trim(),
                nextInspectionDate: document.getElementById('nextInspectionDate').value
            };

            const errors = validateInspectionData(data);
            if (errors.length > 0) {
                showNotification(`Validation errors:\n${errors.join('\n')}`, 'error');
                return;
            }

            const newInspection = {
                date: new Date().toISOString().split('T')[0],
                type: data.inspectionType,
                status: data.healthStatus === 'Critical' ? 'Issues Found' : 'Completed',
                inspector: data.inspectorName,
                issues: data.issuesFound,
                recommendations: data.recommendations
            };

            if (trackDatabase[data.trackId]) {
                trackDatabase[data.trackId].inspectionHistory.unshift(newInspection);
                trackDatabase[data.trackId].lastInspection = newInspection.date;
                trackDatabase[data.trackId].nextInspection = data.nextInspectionDate;
                trackDatabase[data.trackId].trackHealth = data.healthStatus;
            }

            // Clear saved form data
            sessionStorage.removeItem('inspectionFormData');

            showNotification('Inspection report submitted successfully!', 'success');
            cancelInspection();
            displayTrackInfo(data.trackId);
        }

        // Export functionality for admin
        function exportTrackData() {
            if (currentUserRole !== 'admin') {
                showNotification('Only administrators can export data!', 'error');
                return;
            }

            const dataStr = JSON.stringify(trackDatabase, null, 2);
            const dataBlob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `railway_track_data_${new Date().toISOString().split('T')[0]}.json`;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            URL.revokeObjectURL(url);

            showNotification('Track data exported successfully!', 'success');
        }

        // Initialize enhanced features after DOM load
        document.addEventListener('DOMContentLoaded', function () {
            setupAutoSave();
            optimizeAnimations();

            // Add export button for admin (dynamically)
            setTimeout(() => {
                if (currentUserRole === 'admin') {
                    const exportBtn = document.createElement('button');
                    exportBtn.className = 'secondary-btn';
                    exportBtn.textContent = 'üìä Export Data';
                    exportBtn.onclick = exportTrackData;
                    exportBtn.style.position = 'fixed';
                    exportBtn.style.bottom = '20px';
                    exportBtn.style.right = '20px';
                    exportBtn.style.zIndex = '999';
                    document.body.appendChild(exportBtn);
                }
            }, 1000);
        });

        // PWA-like functionality
        let deferredPrompt;
        window.addEventListener('beforeinstallprompt', (e) => {
            deferredPrompt = e;
            showInstallPrompt();
        });

        function showInstallPrompt() {
            const installBtn = document.createElement('button');
            installBtn.className = 'primary-btn';
            installBtn.textContent = 'üì± Install App';
            installBtn.style.position = 'fixed';
            installBtn.style.bottom = '20px';
            installBtn.style.left = '20px';
            installBtn.style.zIndex = '999';
            installBtn.onclick = installApp;
            document.body.appendChild(installBtn);
        }

        function installApp() {
            if (deferredPrompt) {
                deferredPrompt.prompt();
                deferredPrompt.userChoice.then((result) => {
                    if (result.outcome === 'accepted') {
                        showNotification('App installed successfully!', 'success');
                    }
                    deferredPrompt = null;
                });
            }
        }

        // Service worker registration for offline functionality
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/sw.js')
                    .then((registration) => {
                        console.log('SW registered: ', registration);
                    })
                    .catch((registrationError) => {
                        console.log('SW registration failed: ', registrationError);
                    });
            });
        }

        // Accessibility enhancements
        function enhanceAccessibility() {
            // Add ARIA labels
            document.querySelectorAll('.primary-btn, .secondary-btn').forEach(btn => {
                if (!btn.getAttribute('aria-label')) {
                    btn.setAttribute('aria-label', btn.textContent);
                }
            });

            // Add focus indicators
            document.querySelectorAll('input, select, textarea, button').forEach(element => {
                element.addEventListener('focus', function () {
                    this.style.outline = '2px solid var(--accent-blue)';
                    this.style.outlineOffset = '2px';
                });
                element.addEventListener('blur', function () {
                    this.style.outline = 'none';
                });
            });

            // Add keyboard navigation
            document.addEventListener('keydown', function (event) {
                if (event.key === 'Tab') {
                    document.body.classList.add('keyboard-nav');
                }
            });

            document.addEventListener('mousedown', function () {
                document.body.classList.remove('keyboard-nav');
            });
        }

        // Performance monitoring
        function monitorPerformance() {
            if ('performance' in window) {
                window.addEventListener('load', () => {
                    setTimeout(() => {
                        const perfData = performance.getEntriesByType('navigation')[0];
                        console.log('Page load time:', perfData.loadEventEnd - perfData.fetchStart, 'ms');
                    }, 0);
                });
            }
        }

        // Error handling and reporting
        window.addEventListener('error', function (event) {
            console.error('Application error:', event.error);
            showNotification('An unexpected error occurred. Please refresh the page.', 'error');
        });

        window.addEventListener('unhandledrejection', function (event) {
            console.error('Unhandled promise rejection:', event.reason);
            showNotification('A network error occurred. Please check your connection.', 'error');
        });

        // Initialize all enhancements
        document.addEventListener('DOMContentLoaded', function () {
            enhanceAccessibility();
            monitorPerformance();

            // Load any saved form data
            setTimeout(() => {
                if (currentUserRole === 'inspector') {
                    loadFormData();
                }
            }, 500);
        });
    </script>
</body>

</html>